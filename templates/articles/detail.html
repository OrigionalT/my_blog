{% extends "base.html" %}
{% load staticfiles %}
{% block title %}
{% endblock %}
{% block content %}

    <!-- 文章详情 -->
    <div class="container">
        <div class="row">
            <div class="col-9">
                <!-- 标题及作者 -->
                <h1 class="mt-4 mb-4">{{ article.title }}</h1>
                <div class="alert alert-success">
                    <div>
                        作者：{{ article.author }}
                        {% if user == article.author %}

                            <!-- · <a href="#" onclick="confirm_delete()">删除文章</a> -->
                            · <a href="#" onclick="confirm_safe_delete()">删除文章</a>
                            <form
                                    style="display:none;"
                                    id="safe_delete"
                                    action="{% url 'articles:article_safe_delete' article.id %}"
                                    method="POST"
                            >
                                {% csrf_token %}
                                <button type="submit">发送</button>
                            </form>
                            · <a href="{% url "articles:article_update" article.id %}">编辑文章 </a>
                        {% endif %}
                    </div>

                    <div>
                        浏览：{{ article.total_views }}
                    </div>

                </div>

                <!-- 文章正文 -->
                <div class="col-12">
                    <p>{{ article.body|safe }}</p>
                </div>
            </div>

            {#        <!-- 新增的目录 -->#}
            {#        <div class="col-3 mt-4">#}
            {#            <h4><strong>目录</strong></h4>#}
            {#            <hr>#}
            {#            <div>#}
            {#                {{ toc|safe }}#}
            {#            </div>#}
            {#        </div>#}
            <!-- 目录 -->
            <div class="col-3 mt-4" id="sidebar" class="sidebar">
                <div class="sidebar__inner">
                    <h4><strong>目录</strong></h4>
                    <hr>
                    <div>
                        {{ toc|safe }}
                    </div>
                </div>
            </div>

        </div>
    </div>
        {#    <script>#}
        {#        // 删除文章的函数#}
        {#        function confirm_delete() {#}
        {#            // 调用layer弹窗组件#}
        {#            layer.open({#}
        {#                // 弹窗标题#}
        {#                title: "确认删除",#}
        {#                // 正文#}
        {#                content: "确认删除这篇文章吗？",#}
        {#                // 点击确定按钮后调用的回调函数#}
        {#                yes: function (index, layero) {#}
        {#                    // 指定应当前往的 url#}
        {#                    location.href = '{% url "articles:article_delete" article.id %}'#}
        {#                },#}
        {#            })#}
        {#        }#}
        {#    </script>#}
        <style>
            .sidebar {
                will-change: min-height;
            }

            .sidebar__inner {
                transform: translate(0, 0); /* For browsers don't support translate3d. */
                transform: translate3d(0, 0, 0);
                will-change: position, transform;
            }
        </style>
        <script>
            function confirm_safe_delete() {
                layer.open({
                    title: "确认删除",
                    content: "确认删除这篇文章吗？",
                    yes: function (index, layero) {
                        $('form#safe_delete button').click();
                        layer.close(index);
                    }
                })
            }
        </script>
{% endblock %}